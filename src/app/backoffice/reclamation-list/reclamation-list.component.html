<div class="container mt-4">
  <h2 class="text-center text-primary mb-4">Liste des Réclamations</h2>
  
  <!-- Panneau de recherche et filtrage -->
  <div class="mb-4">
    <!-- Actions principales -->
    <div class="col-md-6">
      <div class="dropdown">
        <button class="btn btn-warning me-2" (click)="showStatsDropdown = !showStatsDropdown">
          <i class="fas fa-chart-bar"></i> Voir Statistiques
          <i class="fas fa-caret-down ms-2"></i>
        </button>
        <div class="dropdown-menu" [class.show]="showStatsDropdown">
          <a class="dropdown-item" (click)="navigateToStatistics('type')">
            <i class="fas fa-chart-pie me-2"></i>
            Statistiques des Réclamations par TYPE
          </a>
          <a class="dropdown-item" (click)="navigateToStatistics('status')">
            <i class="fas fa-chart-bar me-2"></i>
            Statistiques des Réclamations par STATUS
          </a>
          <a class="dropdown-item" (click)="navigateToStatistics('histogram')">
            <i class="fas fa-chart-line me-2"></i>
            Histogramme (Stacked Bar Chart)
          </a>
        </div>
      </div>
      <button class="btn btn-success" (click)="addComplaint()">
        <i class="fas fa-plus"></i> Ajouter une Réclamation
      </button>
    </div>

    <!-- Filtres -->
    <div class="row">
      <!-- Filtre par Type -->
      <div class="col-md-6 mb-3">
        <div class="input-group">
          <label class="input-group-text" for="typeFilter">Filtrer par Type:</label>
          <select class="form-select" id="typeFilter" [(ngModel)]="selectedType" (change)="applyFilters()">
            <option value="">Tous</option>
            <option *ngFor="let type of complaintTypes" [value]="type">{{ type }}</option>
          </select>
          <button *ngIf="selectedType" class="btn btn-outline-secondary" (click)="clearTypeFilter()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Recherche par Status -->
<div class="col-md-6 mb-3">
  <div class="input-group">
    <label class="input-group-text" for="statusSearch">Chercher par Status:</label>
    <input type="text" 
           class="form-control" 
           id="statusSearch"
           [(ngModel)]="statusSearchText"
           (input)="filterByStatus()"
           placeholder="Rechercher par status..."
           list="statusOptions">
    <datalist id="statusOptions">
      <option *ngFor="let status of complaintStatuses" [value]="status">
        {{status}}
      </option>
    </datalist>
    <button *ngIf="statusSearchText" 
            class="btn btn-outline-secondary" 
            (click)="clearStatusFilter()">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>

    <!-- Filtres actifs -->
    <div *ngIf="selectedType" class="mt-2 mb-3">
      <div class="d-flex align-items-center">
        <span class="me-2">Filtres actifs:</span>
        <span class="badge bg-primary me-2">
          Type: {{ selectedType }}
          <i class="fas fa-times ms-2" style="cursor: pointer;" (click)="clearTypeFilter()"></i>
        </span>
      </div>
    </div>
  </div>

  <!-- Table des réclamations -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="thead-dark">
        <tr>
          <th>Titre</th>
          <th>Description</th>
          <th>Type</th>
          <th>Date de Création</th>
          <th>Date de Dernière Modification</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let complaint of filteredComplaints | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage }">
          <td>{{ complaint.title }}</td>
          <td>{{ complaint.description }}</td>
          <td>{{ complaint.type }}</td>
          <td>{{ complaint.creationDate | date:'short' }}</td>
          <td>{{ complaint.lastModifiedDate | date:'short' }}</td>
          <td>
            <span [ngClass]="getStatusClass(complaint.status)">
              {{ complaint.status }}
            </span>
          </td>
          <td>
            <button class="btn btn-primary btn-sm mb-1 me-1" (click)="editComplaint(complaint.id)">
              <i class="fas fa-edit"></i> Modifier
            </button>
            <button class="btn btn-danger btn-sm mb-1 me-1" (click)="openDeleteConfirmModal(complaint)">
              <i class="fas fa-trash-alt"></i> Supprimer
            </button>
            <button class="btn btn-info btn-sm mb-1 me-1" (click)="openModal(complaint)">
              <i class="fas fa-eye"></i> Détail
            </button>
            <button class="btn btn-secondary btn-sm mb-1" (click)="handleComplaint(complaint.id)">
              <i class="fas fa-cogs"></i> Traiter
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <!-- Modals de suppression -->
<!-- Modal de confirmation de suppression -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteConfirmModalLabel">
          <i class="fas fa-exclamation-triangle"></i> Confirmation de suppression
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>Êtes-vous sûr de vouloir supprimer cette réclamation ?</p>
        <div class="alert alert-warning">
          <p><strong>Titre:</strong> {{ selectedComplaint?.title }}</p>
          <p><strong>Type:</strong> {{ selectedComplaint?.type }}</p>
          <p><strong>Statut:</strong> 
            <span [ngClass]="getStatusClass(selectedComplaint?.status)">
              {{ selectedComplaint?.status }}
            </span>
          </p>
        </div>
        <p class="text-danger">
          <i class="fas fa-exclamation-circle"></i>
          Cette action est irréversible !
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times"></i> Annuler
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">
          <i class="fas fa-trash-alt"></i> Supprimer
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de succès de suppression -->
<div class="modal fade" id="deleteSuccessModal" tabindex="-1" aria-labelledby="deleteSuccessModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="deleteSuccessModalLabel">
          <i class="fas fa-check-circle"></i> Suppression réussie
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>La réclamation a été supprimée avec succès.</p>
        <div class="mt-3">
          <p><strong>Supprimé par:</strong> {{ currentUser }}</p>
          <p><strong>Date et heure:</strong> {{ currentDateTime | date:'dd/MM/yyyy HH:mm:ss' }}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal">
          <i class="fas fa-check"></i> OK
        </button>
      </div>
    </div>
  </div>
</div>
  </div>

  <!-- Message si aucun résultat -->
  <div *ngIf="filteredComplaints.length === 0" class="alert alert-warning text-center">
    <i class="fas fa-exclamation-triangle"></i> Aucune réclamation ne correspond aux critères de recherche.
  </div>

  <!-- Pagination -->
  <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>

  <!-- Modals -->
  <!-- ... Le reste des modals reste inchangé ... -->
</div>