<div class="review-list-container">
    <div class="action-bar mb-4">
      <button mat-raised-button color="primary" routerLink="/client/reviews/new">
        <mat-icon>add</mat-icon>
        Ajouter un avis
      </button>
    </div>
  
    <!-- Message si aucun avis -->
    <div *ngIf="!isLoading && reviews.length === 0" class="alert alert-info">
      Aucun avis trouvé
    </div>
  
    <div class="reviews-grid" *ngIf="!isLoading && reviews.length > 0">
      <mat-card *ngFor="let review of reviews" class="review-card">
        <mat-card-header>
          <mat-card-title>
            <div class="rating">
              <mat-icon *ngFor="let star of [1,2,3,4,5]" 
                        [class.text-warning]="star <= review.rating"
                        [class.text-muted]="star > review.rating">
                star
              </mat-icon>
            </div>
          </mat-card-title>
          <mat-card-subtitle>
            Par {{ review.client?.login || 'Anonyme' }}
            le {{ review.createdAt | date:'dd/MM/yyyy HH:mm' }}
          </mat-card-subtitle>
        </mat-card-header>
  
        <mat-card-content>
          <p class="mt-3">{{ review.comment }}</p>
          
          <div class="mt-2">
            <mat-chip-listbox>
              <mat-chip *ngFor="let category of review.categories">
                {{ category }}
              </mat-chip>
            </mat-chip-listbox>
          </div>
        </mat-card-content>
  
        <mat-card-actions align="end">
          <!-- Bouton de suppression pour les avis de l'utilisateur courant -->
          <ng-container *ngIf="review.client?.login === currentUser">
            <button mat-icon-button 
                    color="warn" 
                    (click)="openDeleteConfirmModal(review)"
                    matTooltip="Supprimer cet avis">
              <mat-icon>delete</mat-icon>
            </button>
          </ng-container>
          
          <!-- Bouton "Utile" pour les autres avis -->
          <ng-container *ngIf="review.client?.login !== currentUser">
            <button mat-button (click)="onMarkHelpful(review.id)">
              <mat-icon>thumb_up</mat-icon>
              <span class="ms-1">{{ review.helpfulVotes || 0 }}</span>
            </button>
          </ng-container>
        </mat-card-actions>
      </mat-card>
    </div>
  
    <!-- Pagination -->
    <mat-paginator *ngIf="reviews.length > 0"
                   [length]="totalReviews"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   (page)="handlePageEvent($event)">
    </mat-paginator>
  
    <!-- Modal de confirmation de suppression -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">Confirmer la suppression</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>Êtes-vous sûr de vouloir supprimer cet avis ?</p>
            <div class="alert alert-light">
              <p class="mb-0"><strong>Contenu de l'avis :</strong></p>
              <p class="mb-0">{{ selectedReview?.comment }}</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Annuler
            </button>
            <button type="button" class="btn btn-danger" (click)="confirmDelete()">
              Supprimer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>